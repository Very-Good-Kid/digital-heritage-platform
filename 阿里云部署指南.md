# 阿里云OSS静态网站托管部署指南

## 部署说明

由于阿里云OSS静态托管仅支持静态网站（HTML、CSS、JS），不支持后端服务（Python Flask），本指南提供两种部署方案：

### 方案一：纯前端部署（演示版）✅ 推荐

**适用场景**：
- 仅展示网站前端界面
- 演示功能和用户流程
- 不需要实际的数据存储和处理

**部署步骤**：

1. **准备文件**
   - `dist/` 目录包含所有前端文件
   - HTML模板、CSS、JS、静态资源

2. **上传到阿里云OSS**
   - 登录阿里云控制台
   - 进入OSS服务
   - 创建Bucket（选择"公共读"权限）
   - 上传`dist/`目录下的所有文件

3. **配置静态网站托管**
   - 在Bucket设置中启用"静态网站托管"
   - 设置默认首页文档为`index.html`
   - 设置默认404页面为`errors/404.html`

4. **访问网站**
   - 使用OSS提供的域名访问
   - 或绑定自定义域名

**限制**：
- ❌ 无法实现用户注册登录
- ❌ 无法保存数据到数据库
- ❌ 无法生成PDF文件
- ❌ 仅作为演示展示

### 方案二：完整部署（需要服务器）✅ 推荐

**适用场景**：
- 需要完整的后端功能
- 需要数据存储和处理
- 需要PDF生成功能

**部署架构**：

```
用户 → 阿里云CDN → 阿里云OSS（静态资源） → 阿里云ECS（后端服务）
                               ↓
                          阿里云RDS（数据库）
```

**部署步骤**：

1. **准备服务器**
   - 购买阿里云ECS服务器
   - 安装Python环境和依赖
   - 配置安全组规则

2. **上传代码**
   - 将整个项目上传到ECS服务器
   - 安装依赖：`pip install -r requirements.txt`

3. **配置数据库**
   - 购买阿里云RDS MySQL实例
   - 修改数据库配置
   - 初始化数据库

4. **部署后端服务**
   - 使用Gunicorn或uWSGI部署Flask应用
   - 配置Nginx反向代理
   - 配置SSL证书（HTTPS）

5. **配置OSS和CDN**
   - 将静态资源上传到OSS
   - 配置CDN加速
   - 绑定自定义域名

6. **访问网站**
   - 使用绑定的域名访问
   - 配置HTTPS安全访问

## dist目录结构

```
dist/
├── index.html                    # 演示版首页
├── about.html                    # 关于我们
├── dashboard/                    # 仪表盘（需要后端）
├── assets/                       # 数字资产（需要后端）
├── wills/                        # 数字遗嘱（需要后端）
├── policies/                     # 平台政策
├── inheritance-guide/            # 继承导航
├── stories/                      # 故事墙
├── faq/                          # FAQ
├── errors/                       # 错误页面
└── static/
    └── templates/                 # PDF模板文件
        ├── 数字资产清单模板.pdf
        └── 数字遗产意愿声明模板.pdf
```

## 快速部署（方案一）

### 1. 打包dist目录

```bash
# 在Windows上
cd dist
Compress-Archive -Path * -DestinationPath digital-heritage.zip

# 或使用ZIP工具手动打包dist目录
```

### 2. 上传到阿里云OSS

1. 登录阿里云控制台
2. 进入"对象存储 OSS"
3. 创建新Bucket
   - Bucket名称：例如 `digital-heritage-website`
   - 地域：选择离用户最近的区域
   - 存储类型：标准存储
   - 读写权限：公共读

4. 上传文件
   - 点击"文件管理"
   - 点击"上传文件"
   - 选择打包的`digital-heritage.zip`文件
   - 上传后解压（或直接上传dist目录下的所有文件）

### 3. 配置静态网站托管

1. 在Bucket设置中找到"静态网站托管"
2. 点击"设置"
3. 配置以下项：
   - 首页：`index.html`
   - 404页面：`errors/404.html`
   - 子目录首页：留空
   - 默认404页面：`errors/404.html`
4. 点击"创建"

### 4. 访问网站

- OSS会提供一个访问域名，格式为：`http://bucket-name.oss-region.aliyuncs.com`
- 也可以绑定自定义域名

## 完整部署（方案二）

### 1. 服务器配置

**购买服务器**：
- 阿里云ECS（推荐2核4G或更高配置）
- 操作系统：Ubuntu 20.04 LTS 或 CentOS 7

**安装环境**：
```bash
# 更新系统
sudo apt update && sudo apt upgrade -y

# 安装Python
sudo apt install python3 python3-pip python3-venv -y

# 安装Nginx
sudo apt install nginx -y

# 安装MySQL客户端
sudo apt install mysql-client -y
```

### 2. 部署后端服务

**上传代码**：
```bash
# 使用SCP上传代码
scp -r demo/* user@your-server-ip:/var/www/digital-heritage/

# 或使用Git
git clone your-repo-url /var/www/digital-heritage
```

**安装依赖**：
```bash
cd /var/www/digital-heritage
python3 -m venv venv
source venv/bin/activate
pip install -r requirements.txt
pip install gunicorn
```

**配置数据库**：
```bash
# 安装MySQL
sudo apt install mysql-server -y

# 创建数据库
mysql -u root -p
CREATE DATABASE digital_heritage CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
CREATE USER 'digital_user'@'localhost' IDENTIFIED BY 'your_password';
GRANT ALL PRIVILEGES ON digital_heritage.* TO 'digital_user'@'localhost';
FLUSH PRIVILEGES;
```

**修改配置**：
```bash
# 修改config.py中的数据库配置
SQLALCHEMY_DATABASE_URI = 'mysql://digital_user:password@localhost/digital_heritage'
```

**初始化数据库**：
```bash
source venv/bin/activate
python app.py
```

### 3. 配置Gunicorn和Nginx

**创建Gunicorn配置文件**：
```bash
sudo nano /etc/systemd/system/digital-heritage.service
```

内容：
```ini
[Unit]
Description=Gunicorn instance to serve Digital Heritage
After=network.target

[Service]
User=www-data
Group=www-data
WorkingDirectory=/var/www/digital-heritage
Environment="PATH=/var/www/digital-heritage/venv/bin"
ExecStart=/var/www/digital-heritage/venv/bin/gunicorn -w 4 -b 127.0.0.1:5000 app:app

[Install]
WantedBy=multi-user.target
```

**启动服务**：
```bash
sudo systemctl start digital-heritage
sudo systemctl enable digital-heritage
```

**配置Nginx**：
```bash
sudo nano /etc/nginx/sites-available/digital-heritage
```

内容：
```nginx
server {
    listen 80;
    server_name your-domain.com;

    location / {
        proxy_pass http://127.0.0.1:5000;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }

    location /static {
        alias /var/www/digital-heritage/static;
    }
}
```

**启用配置**：
```bash
sudo ln -s /etc/nginx/sites-available/digital-heritage /etc/nginx/sites-enabled/
sudo nginx -t
sudo systemctl restart nginx
```

### 4. 配置OSS和CDN

**上传静态资源到OSS**：
```bash
# 使用阿里云CLI
pip install oss2

# 上传static目录
python upload_to_oss.py
```

**配置CDN**：
1. 在阿里云控制台创建CDN加速域名
2. 添加源站为ECS服务器
3. 配置缓存规则
4. 绑定自定义域名

### 5. 配置HTTPS

**申请SSL证书**：
1. 在阿里云申请免费SSL证书
2. 下载证书文件
3. 配置Nginx使用HTTPS

**Nginx HTTPS配置**：
```nginx
server {
    listen 443 ssl;
    server_name your-domain.com;

    ssl_certificate /path/to/cert.pem;
    ssl_certificate_key /path/to/key.pem;

    location / {
        proxy_pass http://127.0.0.1:5000;
        # ... 其他配置
    }
}
```

## 文件清单

### dist目录文件

**前端文件**（可部署到OSS静态托管）：
- `index.html` - 演示版首页
- `about.html` - 关于我们
- `policies/index.html` - 平台政策
- `inheritance-guide/index.html` - 继承导航
- `stories/index.html` - 故事墙
- `faq/index.html` - FAQ
- `errors/404.html` - 404页面
- `errors/500.html` - 500页面
- `static/templates/数字资产清单模板.pdf` - PDF模板
- `static/templates/数字遗产意愿声明模板.pdf` - PDF模板

**需要后端的文件**（完整部署需要）：
- `dashboard/index.html` - 用户仪表盘
- `assets/index.html` - 数字资产管理
- `assets/edit.html` - 编辑资产
- `wills/index.html` - 数字遗嘱管理
- `wills/view.html` - 查看遗嘱

### 根目录文件（完整部署需要）

**后端代码**：
- `app.py` - 主应用文件
- `config.py` - 配置文件
- `models.py` - 数据库模型
- `utils/` - 工具类目录

**文档**：
- `README.md` - 项目说明
- `USER_GUIDE.md` - 用户指南
- `DEPLOYMENT.md` - 部署指南
- `阿里云部署指南.md` - 本文档

## 成本估算

### 方案一：纯前端部署（OSS静态托管）

- **OSS存储**：约 0.12元/GB/月
- **流量费用**：约 0.5元/GB
- **总成本**：约 5-10元/月（小型网站）

### 方案二：完整部署（ECS + RDS + OSS + CDN）

- **ECS服务器**：约 100-300元/月（2核4G）
- **RDS数据库**：约 200-500元/月（基础版）
- **OSS存储**：约 0.12元/GB/月
- **CDN流量**：约 0.24元/GB
- **总成本**：约 400-1000元/月

## 注意事项

1. **静态托管限制**
   - 不支持后端服务
   - 不支持数据库
   - 不支持文件生成
   - 仅适合演示和展示

2. **完整部署要求**
   - 需要服务器技术知识
   - 需要配置域名和SSL
   - 需要定期维护和备份

3. **安全建议**
   - 使用HTTPS加密传输
   - 定期更新系统和依赖
   - 配置防火墙规则
   - 定期备份数据库

## 总结

**推荐方案**：
- 如果只是演示：使用方案一（OSS静态托管）
- 如果需要完整功能：使用方案二（ECS完整部署）

**当前状态**：
- `dist/` 目录已准备好，可以直接上传到OSS
- 提供了演示版首页，展示网站界面
- 完整部署需要服务器和数据库支持
